<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è°ƒè¯•æŸ¥æ‰¾åŠŸèƒ½</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .debug-info { background: #f0f8ff; padding: 15px; margin: 10px 0; border-radius: 5px; }
        button { padding: 10px 15px; margin: 5px; cursor: pointer; }
        .success { background: #d4edda; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; border: 1px solid #f5c6cb; }
        input { padding: 8px; margin: 5px; }
    </style>
</head>
<body>
    <h1>ğŸ” è°ƒè¯•æŸ¥æ‰¾åŠŸèƒ½</h1>
    
    <div class="debug-info">
        <h3>è°ƒè¯•ä¿¡æ¯:</h3>
        <div id="debugOutput"></div>
    </div>
    
    <div>
        <h3>ğŸ“Š æŒ‰åˆ†æ•°æŸ¥æ‰¾æµ‹è¯•</h3>
        <input type="number" id="scoreInput" placeholder="è¾“å…¥åˆ†æ•°" value="829">
        <button onclick="testDirectScoreSearch()">ç›´æ¥æµ‹è¯•åˆ†æ•°æŸ¥æ‰¾</button>
        <button onclick="testEventBinding()">æµ‹è¯•äº‹ä»¶ç»‘å®š</button>
        <div id="scoreResult"></div>
    </div>
    
    <div>
        <h3>ğŸ‘¤ æŒ‰å°çº¢ä¹¦å·æŸ¥æ‰¾æµ‹è¯•</h3>
        <input type="text" id="nameInput" placeholder="è¾“å…¥å°çº¢ä¹¦å·" value="2789378855">
        <button onclick="testDirectNameSearch()">ç›´æ¥æµ‹è¯•å°çº¢ä¹¦å·æŸ¥æ‰¾</button>
        <div id="nameResult"></div>
    </div>
    
    <button onclick="checkAllElements()">æ£€æŸ¥æ‰€æœ‰å…ƒç´ </button>
    <button onclick="clearAll()">æ¸…ç©ºæ‰€æœ‰ç»“æœ</button>

    <script>
        // è°ƒè¯•è¾“å‡ºå‡½æ•°
        function debugLog(message, isError = false) {
            const debugOutput = document.getElementById('debugOutput');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.innerHTML = `[${timestamp}] ${message}`;
            logEntry.className = isError ? 'error' : 'success';
            debugOutput.appendChild(logEntry);
            console.log(message);
        }
        
        // æ¨¡æ‹Ÿå…¨å±€å˜é‡
        let participants = [
            { id: 'P001', name: '2789378855', score: 829, created_at: '2024-01-01' },
            { id: 'P002', name: 'TEST', score: 600, created_at: '2024-01-02' },
            { id: 'P003', name: '1234567890', score: 829, created_at: '2024-01-03' }
        ];
        
        let allCombinations = [
            {
                members: [
                    { id: 'P001', name: '2789378855', score: 829 },
                    { id: 'P002', name: 'TEST', score: 600 },
                    { id: 'P003', name: '1234567890', score: 597 }
                ]
            }
        ];
        
        // æ¨¡æ‹Ÿå‡½æ•°
        function showToast(message, type = 'success') {
            debugLog(`${type.toUpperCase()}: ${message}`, type === 'error');
        }
        
        function isValidXiaohongshuId(name) {
            return /^[a-zA-Z0-9_-]+$/.test(name) && name.length >= 3;
        }
        
        // ç›´æ¥æµ‹è¯•åˆ†æ•°æŸ¥æ‰¾
        function testDirectScoreSearch() {
            debugLog('å¼€å§‹ç›´æ¥æµ‹è¯•åˆ†æ•°æŸ¥æ‰¾...');
            const score = parseInt(document.getElementById('scoreInput').value);
            
            if (isNaN(score)) {
                debugLog('è¾“å…¥çš„åˆ†æ•°æ— æ•ˆ', true);
                return;
            }
            
            const matchingUsers = participants.filter(p => p.score === score);
            debugLog(`æ‰¾åˆ° ${matchingUsers.length} ä¸ªåŒ¹é…ç”¨æˆ·`);
            
            const resultDiv = document.getElementById('scoreResult');
            if (matchingUsers.length > 0) {
                resultDiv.innerHTML = `<div class="success">âœ… æ‰¾åˆ° ${matchingUsers.length} ä¸ªç”¨æˆ·: ${matchingUsers.map(u => u.name).join(', ')}</div>`;
            } else {
                resultDiv.innerHTML = '<div class="error">âŒ æœªæ‰¾åˆ°åŒ¹é…ç”¨æˆ·</div>';
            }
        }
        
        // ç›´æ¥æµ‹è¯•å°çº¢ä¹¦å·æŸ¥æ‰¾
        function testDirectNameSearch() {
            debugLog('å¼€å§‹ç›´æ¥æµ‹è¯•å°çº¢ä¹¦å·æŸ¥æ‰¾...');
            const name = document.getElementById('nameInput').value.trim();
            
            if (!name) {
                debugLog('è¯·è¾“å…¥å°çº¢ä¹¦å·', true);
                return;
            }
            
            const filtered = allCombinations.filter(combo => 
                combo.members.some(member => member.name === name)
            );
            debugLog(`æ‰¾åˆ° ${filtered.length} ä¸ªåŒ…å« "${name}" çš„ç»„åˆ`);
            
            const resultDiv = document.getElementById('nameResult');
            if (filtered.length > 0) {
                resultDiv.innerHTML = `<div class="success">âœ… æ‰¾åˆ° ${filtered.length} ä¸ªç»„åˆ</div>`;
            } else {
                resultDiv.innerHTML = '<div class="error">âŒ æœªæ‰¾åˆ°åŒ¹é…ç»„åˆ</div>';
            }
        }
        
        // æµ‹è¯•äº‹ä»¶ç»‘å®š
        function testEventBinding() {
            debugLog('å¼€å§‹æµ‹è¯•äº‹ä»¶ç»‘å®š...');
            
            // æ£€æŸ¥æŒ‰é’®æ˜¯å¦å­˜åœ¨
            const buttons = [
                'searchUsersBtn',
                'clearScoreSearchBtn', 
                'queryCombinationsBtn',
                'clearQueryBtn'
            ];
            
            buttons.forEach(btnId => {
                const btn = document.getElementById(btnId);
                if (btn) {
                    debugLog(`âœ… æ‰¾åˆ°æŒ‰é’®: ${btnId}`);
                    // æ·»åŠ æµ‹è¯•äº‹ä»¶
                    btn.onclick = function() {
                        debugLog(`_clicked: ${btnId}`);
                    };
                } else {
                    debugLog(`âŒ æœªæ‰¾åˆ°æŒ‰é’®: ${btnId}`, true);
                }
            });
            
            // æ£€æŸ¥è¾“å…¥æ¡†
            const inputs = ['scoreSearchInput', 'queryNameInput'];
            inputs.forEach(inputId => {
                const input = document.getElementById(inputId);
                if (input) {
                    debugLog(`âœ… æ‰¾åˆ°è¾“å…¥æ¡†: ${inputId}`);
                } else {
                    debugLog(`âŒ æœªæ‰¾åˆ°è¾“å…¥æ¡†: ${inputId}`, true);
                }
            });
        }
        
        // æ£€æŸ¥æ‰€æœ‰å…ƒç´ 
        function checkAllElements() {
            debugLog('æ£€æŸ¥æ‰€æœ‰ç›¸å…³å…ƒç´ ...');
            
            const elementsToCheck = [
                'searchUsersBtn', 'clearScoreSearchBtn',
                'queryCombinationsBtn', 'clearQueryBtn',
                'scoreSearchInput', 'queryNameInput',
                'scoreSearchResult', 'queryResult'
            ];
            
            elementsToCheck.forEach(id => {
                const el = document.getElementById(id);
                debugLog(`${el ? 'âœ…' : 'âŒ'} ${id}: ${el ? 'å­˜åœ¨' : 'ä¸å­˜åœ¨'}`);
            });
        }
        
        // æ¸…ç©ºæ‰€æœ‰ç»“æœ
        function clearAll() {
            document.getElementById('debugOutput').innerHTML = '';
            document.getElementById('scoreResult').innerHTML = '';
            document.getElementById('nameResult').innerHTML = '';
            debugLog('å·²æ¸…ç©ºæ‰€æœ‰ç»“æœ');
        }
        
        // é¡µé¢åŠ è½½å®Œæˆåçš„åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            debugLog('é¡µé¢åŠ è½½å®Œæˆï¼Œå¼€å§‹åˆå§‹åŒ–...');
            checkAllElements();
        });
    </script>
</body>
</html>