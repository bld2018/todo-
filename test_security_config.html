<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å®‰å…¨é…ç½®æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }
        .security-warning {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .test-result {
            margin: 10px 0;
            padding: 10px;
            border-radius: 3px;
        }
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        .danger {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
        input {
            padding: 8px;
            margin: 5px;
            border: 1px solid #ddd;
            border-radius: 3px;
            width: 200px;
        }
        .code-block {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            padding: 15px;
            border-radius: 5px;
            font-family: monospace;
            white-space: pre-wrap;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”’ å®‰å…¨é…ç½®æµ‹è¯•</h1>
        
        <div class="security-warning">
            <strong>âš ï¸ å®‰å…¨æé†’ï¼š</strong> æ­¤é¡µé¢ç”¨äºæµ‹è¯•å®‰å…¨é…ç½®ï¼Œè¯·å‹¿åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨
        </div>

        <!-- é…ç½®æ£€æŸ¥ -->
        <div class="test-section">
            <h3>ğŸ“‹ é…ç½®å®‰å…¨æ£€æŸ¥</h3>
            <button onclick="checkConfigSecurity()">æ£€æŸ¥é…ç½®å®‰å…¨æ€§</button>
            <div id="configCheckResult"></div>
        </div>

        <!-- ç¯å¢ƒå˜é‡æµ‹è¯• -->
        <div class="test-section">
            <h3>âš™ï¸ ç¯å¢ƒå˜é‡æµ‹è¯•</h3>
            <button onclick="testEnvironmentVariables()">æµ‹è¯•ç¯å¢ƒå˜é‡</button>
            <div id="envTestResult"></div>
        </div>

        <!-- å¯†ç å®‰å…¨æµ‹è¯• -->
        <div class="test-section">
            <h3>ğŸ” å¯†ç å®‰å…¨æµ‹è¯•</h3>
            <label>è¾“å…¥æµ‹è¯•å¯†ç : </label>
            <input type="password" id="testPassword" placeholder="è¾“å…¥å¯†ç è¿›è¡Œæµ‹è¯•">
            <button onclick="testPasswordSecurity()">æµ‹è¯•å¯†ç å¤„ç†</button>
            <div id="passwordTestResult"></div>
        </div>

        <!-- æœ¬åœ°å­˜å‚¨æµ‹è¯• -->
        <div class="test-section">
            <h3>ğŸ’¾ æœ¬åœ°å­˜å‚¨æµ‹è¯•</h3>
            <button onclick="testLocalStorage()">æµ‹è¯•æœ¬åœ°å­˜å‚¨</button>
            <button onclick="clearLocalStorage()">æ¸…ç©ºæœ¬åœ°å­˜å‚¨</button>
            <div id="storageTestResult"></div>
        </div>

        <!-- è®¤è¯æµ‹è¯• -->
        <div class="test-section">
            <h3>ğŸ‘¤ è®¤è¯æœºåˆ¶æµ‹è¯•</h3>
            <label>ç”¨æˆ·å: </label>
            <input type="text" id="testUsername" value="admin">
            <label>å¯†ç : </label>
            <input type="password" id="authPassword" placeholder="è¾“å…¥ç®¡ç†å‘˜å¯†ç ">
            <button onclick="testAuthentication()">æµ‹è¯•è®¤è¯</button>
            <div id="authTestResult"></div>
        </div>

        <!-- å®‰å…¨å»ºè®® -->
        <div class="test-section">
            <h3>ğŸ’¡ å®‰å…¨å»ºè®®</h3>
            <div class="code-block" id="securityRecommendations">
// å®‰å…¨é…ç½®å»ºè®®ï¼š
1. ä½¿ç”¨ç¯å¢ƒå˜é‡å­˜å‚¨æ•æ„Ÿä¿¡æ¯
2. å®æ–½å¯†ç å“ˆå¸Œå’Œç›å€¼ä¿æŠ¤
3. å¯ç”¨ç™»å½•å¤±è´¥é”å®šæœºåˆ¶
4. å®šæœŸè½®æ¢å¯†ç å’Œå¯†é’¥
5. ä½¿ç”¨HTTPSä¼ è¾“æ•æ„Ÿæ•°æ®
6. å®æ–½é€‚å½“çš„è®¿é—®æ§åˆ¶
7. å®šæœŸå®¡æŸ¥å®‰å…¨æ—¥å¿—
            </div>
        </div>
    </div>

    <script>
        // æ£€æŸ¥é…ç½®å®‰å…¨æ€§
        function checkConfigSecurity() {
            const resultDiv = document.getElementById('configCheckResult');
            let results = [];
            let isSecure = true;

            // æ£€æŸ¥æ˜¯å¦æœ‰æ˜æ–‡å¯†ç 
            if (typeof DEFAULT_ADMIN !== 'undefined') {
                if (DEFAULT_ADMIN.password) {
                    results.push('âŒ å‘ç°æ˜æ–‡å¯†ç å­˜å‚¨');
                    isSecure = false;
                } else {
                    results.push('âœ… æœªå‘ç°æ˜æ–‡å¯†ç ');
                }
                
                if (typeof DEFAULT_ADMIN.getPassword === 'function') {
                    results.push('âœ… ä½¿ç”¨å®‰å…¨çš„å¯†ç è·å–æ–¹æ³•');
                } else {
                    results.push('âš ï¸ å»ºè®®ä½¿ç”¨ getPassword å‡½æ•°');
                }
            }

            // æ£€æŸ¥ç¯å¢ƒå˜é‡æ”¯æŒ
            if (typeof process !== 'undefined' && process.env) {
                results.push('âœ… æ”¯æŒç¯å¢ƒå˜é‡');
            } else {
                results.push('âš ï¸ ç¯å¢ƒå˜é‡æ”¯æŒæœ‰é™');
            }

            // æ£€æŸ¥æœ¬åœ°å­˜å‚¨æ”¯æŒ
            if (typeof localStorage !== 'undefined') {
                results.push('âœ… æ”¯æŒæœ¬åœ°å­˜å‚¨');
            } else {
                results.push('âŒ ä¸æ”¯æŒæœ¬åœ°å­˜å‚¨');
            }

            const className = isSecure ? 'success' : 'danger';
            resultDiv.innerHTML = `
                <div class="test-result ${className}">
                    <strong>é…ç½®å®‰å…¨æ£€æŸ¥ç»“æœ:</strong><br>
                    ${results.join('<br>')}
                </div>
            `;
        }

        // æµ‹è¯•ç¯å¢ƒå˜é‡
        function testEnvironmentVariables() {
            const resultDiv = document.getElementById('envTestResult');
            let results = [];

            // æ¨¡æ‹Ÿç¯å¢ƒå˜é‡æ£€æŸ¥
            results.push('ğŸ” æ£€æŸ¥ç¯å¢ƒå˜é‡æ”¯æŒ...');
            
            if (typeof process !== 'undefined' && process.env) {
                results.push('âœ… Node.js ç¯å¢ƒå˜é‡å¯ç”¨');
                results.push(`   ADMIN_USERNAME: ${process.env.ADMIN_USERNAME || 'æœªè®¾ç½®'}`);
                results.push(`   ADMIN_PASSWORD: ${process.env.ADMIN_PASSWORD ? '[å·²è®¾ç½®]' : 'æœªè®¾ç½®'}`);
            } else {
                results.push('âš ï¸ æµè§ˆå™¨ç¯å¢ƒï¼Œç¯å¢ƒå˜é‡ä¸å¯ç”¨');
                results.push('ğŸ’¡ å»ºè®®ä½¿ç”¨æœ¬åœ°å­˜å‚¨æˆ–æœåŠ¡å™¨ç«¯ç¯å¢ƒå˜é‡');
            }

            resultDiv.innerHTML = `
                <div class="test-result warning">
                    <strong>ç¯å¢ƒå˜é‡æµ‹è¯•:</strong><br>
                    ${results.join('<br>')}
                </div>
            `;
        }

        // æµ‹è¯•å¯†ç å®‰å…¨
        function testPasswordSecurity() {
            const password = document.getElementById('testPassword').value;
            const resultDiv = document.getElementById('passwordTestResult');
            
            if (!password) {
                resultDiv.innerHTML = '<div class="test-result danger">è¯·è¾“å…¥æµ‹è¯•å¯†ç </div>';
                return;
            }

            let results = [];
            let score = 0;

            // å¯†ç å¼ºåº¦æ£€æŸ¥
            if (password.length >= 8) score++;
            if (/[A-Z]/.test(password)) score++;
            if (/[a-z]/.test(password)) score++;
            if (/[0-9]/.test(password)) score++;
            if (/[^A-Za-z0-9]/.test(password)) score++;

            results.push(`å¯†ç é•¿åº¦: ${password.length} å­—ç¬¦`);
            results.push(`åŒ…å«å¤§å†™å­—æ¯: ${/[A-Z]/.test(password) ? 'âœ“' : 'âœ—'}`);
            results.push(`åŒ…å«å°å†™å­—æ¯: ${/[a-z]/.test(password) ? 'âœ“' : 'âœ—'}`);
            results.push(`åŒ…å«æ•°å­—: ${/[0-9]/.test(password) ? 'âœ“' : 'âœ—'}`);
            results.push(`åŒ…å«ç‰¹æ®Šå­—ç¬¦: ${/[^A-Za-z0-9]/.test(password) ? 'âœ“' : 'âœ—'}`);

            const strength = score >= 4 ? 'å¼º' : score >= 3 ? 'ä¸­ç­‰' : 'å¼±';
            const className = score >= 4 ? 'success' : score >= 3 ? 'warning' : 'danger';

            results.push(`å¯†ç å¼ºåº¦: ${strength} (${score}/5)`);

            resultDiv.innerHTML = `
                <div class="test-result ${className}">
                    <strong>å¯†ç å®‰å…¨åˆ†æ:</strong><br>
                    ${results.join('<br>')}
                </div>
            `;
        }

        // æµ‹è¯•æœ¬åœ°å­˜å‚¨
        function testLocalStorage() {
            const resultDiv = document.getElementById('storageTestResult');
            let results = [];

            if (typeof localStorage !== 'undefined') {
                try {
                    // æµ‹è¯•å­˜å‚¨åŠŸèƒ½
                    const testKey = 'security_test_' + Date.now();
                    localStorage.setItem(testKey, 'test_value');
                    
                    if (localStorage.getItem(testKey) === 'test_value') {
                        results.push('âœ… æœ¬åœ°å­˜å‚¨åŠŸèƒ½æ­£å¸¸');
                        localStorage.removeItem(testKey);
                    } else {
                        results.push('âŒ æœ¬åœ°å­˜å‚¨è¯»å†™å¼‚å¸¸');
                    }

                    // æ£€æŸ¥ç°æœ‰å®‰å…¨ç›¸å…³çš„å­˜å‚¨
                    const items = ['dev_admin_password', 'admin_authenticated', 'admin_token'];
                    items.forEach(item => {
                        const value = localStorage.getItem(item);
                        if (value) {
                            results.push(`âš ï¸ å‘ç°å­˜å‚¨é¡¹: ${item} (${value.length} å­—ç¬¦)`);
                        }
                    });

                } catch (error) {
                    results.push(`âŒ æœ¬åœ°å­˜å‚¨é”™è¯¯: ${error.message}`);
                }
            } else {
                results.push('âŒ ä¸æ”¯æŒæœ¬åœ°å­˜å‚¨');
            }

            resultDiv.innerHTML = `
                <div class="test-result warning">
                    <strong>æœ¬åœ°å­˜å‚¨æµ‹è¯•:</strong><br>
                    ${results.join('<br>')}
                </div>
            `;
        }

        // æ¸…ç©ºæœ¬åœ°å­˜å‚¨
        function clearLocalStorage() {
            if (typeof localStorage !== 'undefined') {
                const keysToRemove = [];
                for (let i = 0; i < localStorage.length; i++) {
                    const key = localStorage.key(i);
                    if (key && key.includes('admin') || key.includes('security')) {
                        keysToRemove.push(key);
                    }
                }
                
                keysToRemove.forEach(key => {
                    localStorage.removeItem(key);
                });
                
                document.getElementById('storageTestResult').innerHTML = `
                    <div class="test-result success">
                        âœ… å·²æ¸…ç©º ${keysToRemove.length} ä¸ªå®‰å…¨ç›¸å…³å­˜å‚¨é¡¹
                    </div>
                `;
            }
        }

        // æµ‹è¯•è®¤è¯
        function testAuthentication() {
            const username = document.getElementById('testUsername').value;
            const password = document.getElementById('authPassword').value;
            const resultDiv = document.getElementById('authTestResult');
            
            if (!username || !password) {
                resultDiv.innerHTML = '<div class="test-result danger">è¯·è¾“å…¥ç”¨æˆ·åå’Œå¯†ç </div>';
                return;
            }

            let results = [];
            
            // æ¨¡æ‹Ÿè®¤è¯è¿‡ç¨‹
            results.push('ğŸ” å¼€å§‹è®¤è¯æµ‹è¯•...');
            results.push(`ç”¨æˆ·å: ${username}`);
            results.push('å¯†ç : ***** (å·²éšè—)');
            
            // æ£€æŸ¥æ˜¯å¦ä½¿ç”¨å®‰å…¨æ–¹æ³•
            if (typeof DEFAULT_ADMIN !== 'undefined' && typeof DEFAULT_ADMIN.getPassword === 'function') {
                const storedPassword = DEFAULT_ADMIN.getPassword();
                if (storedPassword === null) {
                    results.push('âœ… ä½¿ç”¨åŠ¨æ€å¯†ç è·å–ï¼ˆæ¨èï¼‰');
                } else if (storedPassword) {
                    results.push('âš ï¸ å‘ç°é™æ€å¯†ç å­˜å‚¨');
                }
            }

            // æ¨¡æ‹Ÿè®¤è¯ç»“æœ
            setTimeout(() => {
                const isSuccess = username === 'admin' && password.length > 0;
                const className = isSuccess ? 'success' : 'danger';
                const message = isSuccess ? 'è®¤è¯æˆåŠŸ' : 'è®¤è¯å¤±è´¥';
                
                results.push(`ğŸ” è®¤è¯ç»“æœ: ${message}`);
                
                if (isSuccess) {
                    results.push('ğŸ’¡ å»ºè®®å®æ–½ä»¥ä¸‹å®‰å…¨æªæ–½:');
                    results.push('   â€¢ ä½¿ç”¨å¯†ç å“ˆå¸Œå­˜å‚¨');
                    results.push('   â€¢ å®æ–½ç™»å½•å¤±è´¥é”å®š');
                    results.push('   â€¢ å¯ç”¨åŒå› ç´ è®¤è¯');
                    results.push('   â€¢ å®šæœŸè½®æ¢å¯†ç ');
                }

                resultDiv.innerHTML = `
                    <div class="test-result ${className}">
                        <strong>è®¤è¯æµ‹è¯•ç»“æœ:</strong><br>
                        ${results.join('<br>')}
                    </div>
                `;
            }, 1000);
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨è¿è¡ŒåŸºç¡€æ£€æŸ¥
        window.addEventListener('load', () => {
            setTimeout(checkConfigSecurity, 500);
        });
    </script>
</body>
</html>