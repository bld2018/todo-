<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è‡ªåŠ¨åŒ¹é…åŠŸèƒ½æµ‹è¯•</title>
    <link rel="stylesheet" href="style.css">
    <style>
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #e4edf5 100%);
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
            padding: 20px;
        }
        .test-container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #e8e8e8;
            border-radius: 8px;
        }
        .test-btn {
            margin: 5px;
            padding: 10px 20px;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1 style="text-align: center; color: #1890ff; margin-bottom: 30px;">ğŸ¤– è‡ªåŠ¨åŒ¹é…åŠŸèƒ½æµ‹è¯•</h1>
        
        <!-- æµ‹è¯•æ§åˆ¶é¢æ¿ -->
        <div class="test-section">
            <h2>ğŸ® æµ‹è¯•æ§åˆ¶</h2>
            <button class="btn btn-primary test-btn" onclick="testAddParticipants()">æ·»åŠ æµ‹è¯•å‚ä¸è€…</button>
            <button class="btn btn-success test-btn" onclick="testMatchTeams()">æ‰§è¡ŒåŒ¹é…</button>
            <button class="btn btn-warning test-btn" onclick="testAutoMatch()">æµ‹è¯•è‡ªåŠ¨åŒ¹é…</button>
            <button class="btn btn-danger test-btn" onclick="clearAllData()">æ¸…ç©ºæ•°æ®</button>
        </div>
        
        <!-- ç™»è®°ç»„é˜ŸåŒºåŸŸ -->
        <div class="test-section">
            <h2>ğŸ“‹ ç™»è®°ç»„é˜Ÿ</h2>
            <div class="form-group">
                <label for="nameInput">å°çº¢ä¹¦å·ï¼š<span class="required">*</span></label>
                <input type="text" id="nameInput" placeholder="ä¾‹å¦‚ï¼š2789378855" class="form-control">
            </div>
            <div class="form-group">
                <label for="scoreInput">èŠéº»åˆ† (350-950)<span class="required">*</span></label>
                <input type="number" id="scoreInput" min="350" max="950" placeholder="ä¾‹å¦‚ï¼š829" class="form-control">
            </div>
            <button class="btn btn-primary btn-block" onclick="addParticipant()">
                <span class="btn-icon">âœš</span> ç™»è®°ç»„é˜Ÿ
            </button>
            
            <!-- è‡ªåŠ¨åŒ¹é…å¼€å…³ -->
            <div class="form-group" style="margin-top: 15px; padding: 12px; background: #f0f8ff; border-radius: 8px; border: 1px solid #d1e7ff;">
                <div style="display: flex; align-items: center; justify-content: space-between;">
                    <div>
                        <label style="font-weight: 600; color: #1a365d; margin-bottom: 5px; display: block;">
                            ğŸ¤– è‡ªåŠ¨åŒ¹é…é˜Ÿå‹
                        </label>
                        <small style="color: #4a5568; font-size: 0.85rem;">
                            ç™»è®°åè‡ªåŠ¨æ˜¾ç¤ºåŒ…å«è¯¥ç”¨æˆ·çš„æ‰€æœ‰é˜Ÿä¼
                        </small>
                    </div>
                    <label class="switch">
                        <input type="checkbox" id="autoMatchToggle" onchange="toggleAutoMatch(this.checked)">
                        <span class="slider"></span>
                    </label>
                </div>
            </div>
            
            <!-- è‡ªåŠ¨åŒ¹é…ç»“æœæ˜¾ç¤ºåŒºåŸŸ -->
            <div id="autoMatchResult" class="auto-match-result" style="margin-top: 15px;">
                <div class="card-header">
                    <h3 style="margin: 0; color: #1890ff;">ğŸ¤– è‡ªåŠ¨åŒ¹é…ç»“æœ</h3>
                </div>
                <div id="autoMatchContent" style="margin-top: 15px;">
                    <!-- è‡ªåŠ¨åŒ¹é…ç»“æœå°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
                </div>
            </div>
        </div>
        
        <!-- åŒ¹é…ç»“æœæ˜¾ç¤ºåŒºåŸŸ -->
        <div class="test-section">
            <h2>ğŸ¯ åŒ¹é…ç»“æœ</h2>
            <button class="btn btn-success btn-block" onclick="matchTeams()">
                <span class="btn-icon">ğŸ”</span>ç«‹å³æŸ¥æ‰¾æ‰€æœ‰ç»„åˆ
            </button>
            
            <div class="form-group" style="margin-top: 20px; padding: 15px; background: #f9fbfd; border-radius: 10px;">
                <label for="queryNameInput" style="display: block; margin-bottom: 10px; font-weight: 600;">
                    ğŸ” æŸ¥è¯¢è‡ªå·±å°çº¢ä¹¦å·çš„ç»„åˆ
                </label>
                <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                    <input type="text" id="queryNameInput" class="form-control" placeholder="è¾“å…¥å°çº¢ä¹¦å·" 
                    style="flex: 1; min-width: 150px;">
                    <button class="btn btn-primary" onclick="queryCombinations()">
                        <span class="btn-icon">ğŸ”</span>æŸ¥è¯¢
                    </button>
                </div>
            </div>
            
            <div id="queryResult" class="match-result" style="display: none;"></div>
            <div id="matchResult" class="match-result">
                <div class="empty-state">
                    <div class="empty-icon">ğŸ¯</div>
                    <p>ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®å¼€å§‹åŒ¹é…</p>
                    <p class="empty-text">ç³»ç»Ÿå°†æŸ¥æ‰¾æ‰€æœ‰æ€»åˆ†æ°å¥½ç­‰äº2026çš„3äººç»„åˆ</p>
                </div>
            </div>
        </div>
        
        <!-- è°ƒè¯•ä¿¡æ¯ -->
        <div class="test-section">
            <h2>ğŸ“‹ è°ƒè¯•ä¿¡æ¯</h2>
            <div id="debugInfo" style="background: #f0f0f0; padding: 15px; border-radius: 5px; font-family: monospace; white-space: pre-wrap;"></div>
        </div>
    </div>

    <script src="config.js"></script>
    <script src="app.js"></script>
    <script>
        // æµ‹è¯•æ•°æ®
        const testParticipants = [
            { name: "2789378855", score: 829 },
            { name: "1234567890", score: 675 },
            { name: "0987654321", score: 522 },
            { name: "1111111111", score: 950 },
            { name: "2222222222", score: 247 },
            { name: "3333333333", score: 700 }
        ];
        
        let isAutoMatchEnabled = false;
        let lastAddedParticipant = null;
        
        // è°ƒè¯•ä¿¡æ¯è¾“å‡º
        function logDebug(message) {
            const debugEl = document.getElementById('debugInfo');
            const timestamp = new Date().toLocaleTimeString();
            debugEl.textContent += `[${timestamp}] ${message}\n`;
            debugEl.scrollTop = debugEl.scrollHeight;
            console.log(`[${timestamp}] ${message}`);
        }
        
        // æµ‹è¯•å‡½æ•°
        function testAddParticipants() {
            logDebug("å¼€å§‹æ·»åŠ æµ‹è¯•å‚ä¸è€…...");
            testParticipants.forEach(participant => {
                document.getElementById('nameInput').value = participant.name;
                document.getElementById('scoreInput').value = participant.score;
                addParticipant();
            });
            logDebug(`å·²æ·»åŠ  ${testParticipants.length} ä¸ªæµ‹è¯•å‚ä¸è€…`);
        }
        
        function testMatchTeams() {
            logDebug("å¼€å§‹æ‰§è¡ŒåŒ¹é…...");
            matchTeams();
        }
        
        function testAutoMatch() {
            logDebug("å¼€å§‹æµ‹è¯•è‡ªåŠ¨åŒ¹é…åŠŸèƒ½...");
            // å¯ç”¨è‡ªåŠ¨åŒ¹é…
            document.getElementById('autoMatchToggle').checked = true;
            toggleAutoMatch(true);
            
            // æ·»åŠ ä¸€ä¸ªæµ‹è¯•ç”¨æˆ·
            document.getElementById('nameInput').value = "4444444444";
            document.getElementById('scoreInput').value = 600;
            addParticipant();
        }
        
        function clearAllData() {
            logDebug("æ¸…ç©ºæ‰€æœ‰æ•°æ®...");
            participants = [];
            allCombinations = [];
            updateCount();
            renderParticipants();
            
            const matchResultEl = document.getElementById('matchResult');
            const queryResultEl = document.getElementById('queryResult');
            const autoMatchResultEl = document.getElementById('autoMatchResult');
            
            if (matchResultEl) {
                matchResultEl.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">ğŸ¯</div>
                        <p>ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®å¼€å§‹åŒ¹é…</p>
                        <p class="empty-text">ç³»ç»Ÿå°†æŸ¥æ‰¾æ‰€æœ‰æ€»åˆ†æ°å¥½ç­‰äº2026çš„3äººç»„åˆ</p>
                    </div>
                `;
            }
            
            if (queryResultEl) {
                queryResultEl.style.display = 'none';
            }
            
            if (autoMatchResultEl) {
                autoMatchResultEl.style.display = 'none';
            }
            
            logDebug("æ•°æ®å·²æ¸…ç©º");
        }
        
        // é‡å†™æ·»åŠ å‚ä¸è€…å‡½æ•°ä»¥æ”¯æŒè‡ªåŠ¨åŒ¹é…æµ‹è¯•
        const originalAddParticipant = addParticipant;
        addParticipant = function() {
            originalAddParticipant();
            lastAddedParticipant = participants[participants.length - 1];
            
            if (isAutoMatchEnabled && lastAddedParticipant) {
                logDebug(`è‡ªåŠ¨åŒ¹é…å·²å¯ç”¨ï¼Œä¸ºç”¨æˆ· ${lastAddedParticipant.name} æ‰§è¡ŒåŒ¹é…...`);
                setTimeout(() => {
                    performAutoMatch(lastAddedParticipant.name);
                }, 500);
            }
        };
        
        // è‡ªåŠ¨åŒ¹é…å¼€å…³å‡½æ•°
        function toggleAutoMatch(enabled) {
            isAutoMatchEnabled = enabled;
            const resultArea = document.getElementById('autoMatchResult');
            
            if (enabled) {
                resultArea.style.display = 'block';
                logDebug("è‡ªåŠ¨åŒ¹é…åŠŸèƒ½å·²å¯ç”¨");
                if (lastAddedParticipant) {
                    performAutoMatch(lastAddedParticipant.name);
                }
            } else {
                resultArea.style.display = 'none';
                logDebug("è‡ªåŠ¨åŒ¹é…åŠŸèƒ½å·²ç¦ç”¨");
            }
        }
        
        // è‡ªåŠ¨åŒ¹é…æ‰§è¡Œå‡½æ•°
        async function performAutoMatch(xiaohongshuId) {
            logDebug(`æ‰§è¡Œè‡ªåŠ¨åŒ¹é…ï¼ŒæŸ¥æ‰¾ç”¨æˆ·: ${xiaohongshuId}`);
            const resultContent = document.getElementById('autoMatchContent');
            
            if (!xiaohongshuId) {
                resultContent.innerHTML = `
                    <div class="auto-match-empty">
                        <div style="font-size: 2rem; margin-bottom: 10px;">ğŸ¤”</div>
                        <p>è¯·è¾“å…¥å°çº¢ä¹¦å·å¼€å§‹è‡ªåŠ¨åŒ¹é…</p>
                    </div>
                `;
                return;
            }
            
            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            resultContent.innerHTML = `
                <div class="auto-match-loading">
                    <div style="font-size: 2rem; margin-bottom: 10px;">ğŸ”„</div>
                    <p>æ­£åœ¨ä¸º ${xiaohongshuId} å¯»æ‰¾åŒ¹é…çš„é˜Ÿå‹...</p>
                </div>
            `;
            
            try {
                // æ£€æŸ¥æ˜¯å¦éœ€è¦é‡æ–°åŒ¹é…
                if (allCombinations.length === 0 || participants.length < 3) {
                    if (participants.length < 3) {
                        resultContent.innerHTML = `
                            <div class="auto-match-empty">
                                <div style="font-size: 2rem; margin-bottom: 10px;">ğŸ‘¥</div>
                                <p>è‡³å°‘éœ€è¦3ä¸ªå‚ä¸è€…æ‰èƒ½è¿›è¡ŒåŒ¹é…</p>
                                <p style="font-size: 0.9rem; color: #8c8c8c; margin-top: 10px;">
                                    å½“å‰åªæœ‰ ${participants.length} ä¸ªå‚ä¸è€…
                                </p>
                            </div>
                        `;
                        return;
                    }
                    
                    // æ‰§è¡ŒåŒ¹é…
                    await new Promise(resolve => {
                        const originalMatchTeams = matchTeams;
                        matchTeams = function() {
                            originalMatchTeams();
                            setTimeout(resolve, 2000);
                        };
                        matchTeams();
                    });
                }
                
                // æŸ¥è¯¢åŒ…å«è¯¥å°çº¢ä¹¦å·çš„ç»„åˆ
                const filtered = allCombinations.filter(combo => 
                    combo.members.some(member => member.name === xiaohongshuId)
                );
                
                logDebug(`æ‰¾åˆ° ${filtered.length} ä¸ªåŒ…å« "${xiaohongshuId}" çš„ç»„åˆ`);
                
                // æ˜¾ç¤ºç»“æœ
                renderAutoMatchResult(filtered, xiaohongshuId);
                
            } catch (error) {
                logDebug(`è‡ªåŠ¨åŒ¹é…å¤±è´¥: ${error.message}`);
                resultContent.innerHTML = `
                    <div class="auto-match-empty" style="color: #ff4d4f;">
                        <div style="font-size: 2rem; margin-bottom: 10px;">âŒ</div>
                        <p>è‡ªåŠ¨åŒ¹é…å¤±è´¥</p>
                        <p style="font-size: 0.9rem; margin-top: 10px;">${error.message}</p>
                    </div>
                `;
            }
        }
        
        // é¡µé¢åŠ è½½å®Œæˆ
        document.addEventListener('DOMContentLoaded', function() {
            logDebug("æµ‹è¯•é¡µé¢åŠ è½½å®Œæˆ");
            logDebug("è¯·ä½¿ç”¨ä¸Šæ–¹çš„æµ‹è¯•æŒ‰é’®æ¥éªŒè¯åŠŸèƒ½");
        });
    </script>
</body>
</html>