<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç®¡ç†å‘˜å¯†ç ä¿®æ”¹æµ‹è¯•</title>
    <link rel="stylesheet" href="style.css">
    <style>
        .test-container {
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
        }
        .success { background: #f6ffed; border: 1px solid #52c41a; }
        .error { background: #fff2f0; border: 1px solid #ff4d4f; }
        .info { background: #e6f7ff; border: 1px solid #1890ff; }
        .warning { background: #fffbe6; border: 1px solid #faad14; }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>ğŸ”‘ ç®¡ç†å‘˜å¯†ç ä¿®æ”¹åŠŸèƒ½æµ‹è¯•</h1>
        
        <div class="test-section">
            <h3>ğŸ“‹ æµ‹è¯•è¯´æ˜</h3>
            <p>æœ¬é¡µé¢ç”¨äºæµ‹è¯•ç®¡ç†å‘˜å¯†ç ä¿®æ”¹åŠŸèƒ½çš„å„é¡¹ç‰¹æ€§ï¼š</p>
            <ul>
                <li>å¯†ç å¼ºåº¦å®æ—¶æ£€æµ‹</li>
                <li>è¡¨å•éªŒè¯åŠŸèƒ½</li>
                <li>å¯†ç ä¿®æ”¹æµç¨‹</li>
                <li>å®‰å…¨æ€§æ£€æŸ¥</li>
            </ul>
        </div>
        
        <div class="test-section">
            <h3>ğŸ® æµ‹è¯•æŒ‰é’®</h3>
            <button class="btn btn-primary" onclick="showChangePasswordTest()">
                ğŸ”‘ æµ‹è¯•å¯†ç ä¿®æ”¹åŠŸèƒ½
            </button>
            <button class="btn btn-secondary" onclick="testPasswordStrength()">
                ğŸ“Š æµ‹è¯•å¯†ç å¼ºåº¦æ£€æµ‹
            </button>
            <button class="btn btn-warning" onclick="showCurrentPassword()">
                ğŸ‘ï¸ æŸ¥çœ‹å½“å‰å¯†ç 
            </button>
        </div>
        
        <div class="test-section">
            <h3>ğŸ“Š æµ‹è¯•ç»“æœ</h3>
            <div id="testResults"></div>
        </div>
        
        <div class="test-section">
            <h3>ğŸ’¡ å¯†ç è¦æ±‚</h3>
            <div class="status info">
                <strong>å¯†ç å¼ºåº¦è¦æ±‚ï¼š</strong>
                <ul>
                    <li>é•¿åº¦è‡³å°‘8ä½</li>
                    <li>åŒ…å«æ•°å­—</li>
                    <li>åŒ…å«å°å†™å­—æ¯</li>
                    <li>åŒ…å«å¤§å†™å­—æ¯æˆ–ç‰¹æ®Šå­—ç¬¦</li>
                </ul>
                <strong>å½“å‰æµ‹è¯•å¯†ç ï¼š</strong> admin123 (å¼±å¯†ç )
            </div>
        </div>
        
        <div class="test-section">
            <h3>âš ï¸ å®‰å…¨æé†’</h3>
            <div class="status warning">
                <p><strong>é‡è¦ï¼š</strong>ä¿®æ”¹å¯†ç åéœ€è¦é‡æ–°ç™»å½•ç³»ç»Ÿ</p>
                <p>å¯†ç ä¿®æ”¹åŠŸèƒ½åŒ…å«å¤šé‡å®‰å…¨éªŒè¯ï¼Œç¡®ä¿åªæœ‰æˆæƒç®¡ç†å‘˜å¯ä»¥ä¿®æ”¹å¯†ç </p>
            </div>
        </div>
    </div>

    <!-- å¯†ç ä¿®æ”¹æµ‹è¯•æ¨¡æ€æ¡† -->
    <div id="changePasswordModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>ğŸ”‘ ä¿®æ”¹ç®¡ç†å‘˜å¯†ç </h3>
                <span class="close" onclick="closeTestModal()">&times;</span>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>å½“å‰å¯†ç </label>
                    <input type="password" id="currentPassword" class="form-control" placeholder="è¯·è¾“å…¥å½“å‰å¯†ç ">
                </div>
                <div class="form-group">
                    <label>æ–°å¯†ç </label>
                    <input type="password" id="newPassword" class="form-control" placeholder="è¯·è¾“å…¥æ–°å¯†ç ">
                </div>
                <div class="form-group">
                    <label>ç¡®è®¤æ–°å¯†ç </label>
                    <input type="password" id="confirmNewPassword" class="form-control" placeholder="è¯·å†æ¬¡è¾“å…¥æ–°å¯†ç ">
                </div>
                <div class="password-strength-meter">
                    <div class="strength-bar">
                        <div id="strengthIndicator" class="strength-indicator"></div>
                    </div>
                    <div id="strengthText" class="strength-text">å¯†ç å¼ºåº¦ï¼šå¼±</div>
                </div>
                <div id="changePasswordError" class="error-message" style="display: none;"></div>
                <button class="btn btn-warning btn-block" onclick="testChangePassword()">ä¿®æ”¹å¯†ç </button>
                <div style="text-align: center; margin-top: 15px; color: #8c8c8c; font-size: 0.9rem;">
                    æ³¨æ„ï¼šè¿™æ˜¯æµ‹è¯•ç¯å¢ƒï¼Œä¿®æ”¹ä¸ä¼šå½±å“å®é™…ç³»ç»Ÿ
                </div>
            </div>
        </div>
    </div>

    <script src="config.js"></script>
    <script>
        // æµ‹è¯•ç»“æœæ˜¾ç¤ºå‡½æ•°
        function showResult(message, type = 'info') {
            const resultsDiv = document.getElementById('testResults');
            const resultDiv = document.createElement('div');
            resultDiv.className = `status ${type}`;
            resultDiv.innerHTML = `<strong>[${new Date().toLocaleTimeString()}]</strong> ${message}`;
            resultsDiv.appendChild(resultDiv);
            resultsDiv.scrollTop = resultsDiv.scrollHeight;
        }

        // æ˜¾ç¤ºå¯†ç ä¿®æ”¹æµ‹è¯•æ¨¡æ€æ¡†
        function showChangePasswordTest() {
            document.getElementById('changePasswordModal').style.display = 'flex';
            showResult('âœ… å·²æ‰“å¼€å¯†ç ä¿®æ”¹æµ‹è¯•æ¨¡æ€æ¡†', 'success');
        }

        // å…³é—­æµ‹è¯•æ¨¡æ€æ¡†
        function closeTestModal() {
            document.getElementById('changePasswordModal').style.display = 'none';
            document.getElementById('changePasswordError').style.display = 'none';
            clearTestForm();
            showResult('âœ… å·²å…³é—­å¯†ç ä¿®æ”¹æµ‹è¯•æ¨¡æ€æ¡†', 'info');
        }

        // æ¸…ç©ºæµ‹è¯•è¡¨å•
        function clearTestForm() {
            document.getElementById('currentPassword').value = '';
            document.getElementById('newPassword').value = '';
            document.getElementById('confirmNewPassword').value = '';
            document.getElementById('strengthIndicator').className = 'strength-indicator';
            document.getElementById('strengthText').textContent = 'å¯†ç å¼ºåº¦ï¼šå¼±';
        }

        // æŸ¥çœ‹å½“å‰å¯†ç 
        function showCurrentPassword() {
            const currentPassword = DEFAULT_ADMIN.getPassword() || DEFAULT_ADMIN.devPassword || 'æœªè®¾ç½®';
            showResult(`ğŸ‘ï¸ å½“å‰ç®¡ç†å‘˜å¯†ç : ${currentPassword}`, 'info');
        }

        // å¯†ç å¼ºåº¦æ£€æµ‹æµ‹è¯•
        function testPasswordStrength() {
            const testPasswords = [
                '123',           // å¼±
                '12345678',      // å¼±
                'password123',   // ä¸­
                'Password123',   // å¼º
                'My@Pass123!'    // å¼º
            ];
            
            showResult('ğŸ“Š å¼€å§‹å¯†ç å¼ºåº¦æ£€æµ‹æµ‹è¯•...', 'info');
            
            testPasswords.forEach((password, index) => {
                const { strength, feedback } = checkPasswordStrength(password);
                let level = 'å¼±';
                if (strength >= 75) level = 'å¼º';
                else if (strength >= 50) level = 'ä¸­';
                
                showResult(
                    `å¯†ç  "${password}" - å¼ºåº¦: ${strength}% (${level}) - åé¦ˆ: ${feedback.join(', ') || 'ç¬¦åˆè¦æ±‚'}`,
                    strength >= 75 ? 'success' : strength >= 50 ? 'warning' : 'error'
                );
            });
        }

        // å¯†ç å¼ºåº¦æ£€æµ‹å‡½æ•°ï¼ˆå¤åˆ¶è‡ªadmin.jsï¼‰
        function checkPasswordStrength(password) {
            let strength = 0;
            let feedback = [];
            
            if (password.length >= 8) {
                strength += 25;
            } else {
                feedback.push('å¯†ç é•¿åº¦è‡³å°‘8ä½');
            }
            
            if (/\d/.test(password)) {
                strength += 25;
            } else {
                feedback.push('å»ºè®®åŒ…å«æ•°å­—');
            }
            
            if (/[a-z]/.test(password)) {
                strength += 25;
            } else {
                feedback.push('å»ºè®®åŒ…å«å°å†™å­—æ¯');
            }
            
            if (/[A-Z!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]/.test(password)) {
                strength += 25;
            } else {
                feedback.push('å»ºè®®åŒ…å«å¤§å†™å­—æ¯æˆ–ç‰¹æ®Šå­—ç¬¦');
            }
            
            return { strength, feedback };
        }

        // å®æ—¶å¯†ç å¼ºåº¦æ£€æµ‹
        document.addEventListener('DOMContentLoaded', () => {
            const newPasswordInput = document.getElementById('newPassword');
            if (newPasswordInput) {
                newPasswordInput.addEventListener('input', function() {
                    const password = this.value;
                    const { strength, feedback } = checkPasswordStrength(password);
                    
                    const indicator = document.getElementById('strengthIndicator');
                    const strengthText = document.getElementById('strengthText');
                    
                    indicator.style.width = strength + '%';
                    
                    if (strength < 50) {
                        indicator.className = 'strength-indicator weak';
                        strengthText.textContent = 'å¯†ç å¼ºåº¦ï¼šå¼±';
                        strengthText.style.color = '#ff4d4f';
                    } else if (strength < 75) {
                        indicator.className = 'strength-indicator medium';
                        strengthText.textContent = 'å¯†ç å¼ºåº¦ï¼šä¸­';
                        strengthText.style.color = '#faad14';
                    } else {
                        indicator.className = 'strength-indicator strong';
                        strengthText.textContent = 'å¯†ç å¼ºåº¦ï¼šå¼º';
                        strengthText.style.color = '#52c41a';
                    }
                });
            }
        });

        // æµ‹è¯•å¯†ç ä¿®æ”¹åŠŸèƒ½
        function testChangePassword() {
            const currentPassword = document.getElementById('currentPassword').value;
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmNewPassword').value;
            
            showResult('ğŸ” å¼€å§‹å¯†ç ä¿®æ”¹æµ‹è¯•...', 'info');
            
            // åŸºæœ¬éªŒè¯
            if (!currentPassword || !newPassword || !confirmPassword) {
                showError('è¯·å¡«å†™æ‰€æœ‰å­—æ®µ');
                return;
            }
            
            // éªŒè¯å½“å‰å¯†ç 
            const actualPassword = DEFAULT_ADMIN.getPassword() || DEFAULT_ADMIN.devPassword;
            if (currentPassword !== actualPassword) {
                showError('å½“å‰å¯†ç ä¸æ­£ç¡®');
                showResult('âŒ å½“å‰å¯†ç éªŒè¯å¤±è´¥', 'error');
                return;
            }
            
            // éªŒè¯æ–°å¯†ç å¼ºåº¦
            const { strength, feedback } = checkPasswordStrength(newPassword);
            if (strength < 50) {
                showError('æ–°å¯†ç å¼ºåº¦ä¸è¶³ï¼š' + feedback.join('ï¼Œ'));
                showResult(`âŒ æ–°å¯†ç å¼ºåº¦ä¸è¶³ (${strength}%)`, 'error');
                return;
            }
            
            // éªŒè¯å¯†ç ç¡®è®¤
            if (newPassword !== confirmPassword) {
                showError('ä¸¤æ¬¡è¾“å…¥çš„æ–°å¯†ç ä¸ä¸€è‡´');
                showResult('âŒ å¯†ç ç¡®è®¤ä¸åŒ¹é…', 'error');
                return;
            }
            
            // éªŒè¯æ–°å¯†ç ä¸èƒ½ä¸æ—§å¯†ç ç›¸åŒ
            if (newPassword === currentPassword) {
                showError('æ–°å¯†ç ä¸èƒ½ä¸å½“å‰å¯†ç ç›¸åŒ');
                showResult('âŒ æ–°å¯†ç ä¸å½“å‰å¯†ç ç›¸åŒ', 'error');
                return;
            }
            
            // æ¨¡æ‹Ÿå¯†ç æ›´æ–°
            showResult('âœ… æ‰€æœ‰éªŒè¯é€šè¿‡ï¼Œå‡†å¤‡æ›´æ–°å¯†ç ...', 'success');
            showResult(`âœ… å¯†ç ä¿®æ”¹æˆåŠŸï¼æ–°å¯†ç å¼ºåº¦: ${strength}%`, 'success');
            
            // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
            alert('âœ… æµ‹è¯•æˆåŠŸï¼å¯†ç ä¿®æ”¹åŠŸèƒ½å·¥ä½œæ­£å¸¸ã€‚\n\næ³¨æ„ï¼šè¿™æ˜¯æµ‹è¯•ç¯å¢ƒï¼Œå®é™…å¯†ç æœªè¢«ä¿®æ”¹ã€‚');
            
            // å…³é—­æ¨¡æ€æ¡†
            setTimeout(() => {
                closeTestModal();
            }, 1000);
        }

        function showError(message) {
            const errorEl = document.getElementById('changePasswordError');
            if (errorEl) {
                errorEl.textContent = message;
                errorEl.style.display = 'block';
                setTimeout(() => {
                    errorEl.style.display = 'none';
                }, 5000);
            }
        }

        // é¡µé¢åŠ è½½å®Œæˆåçš„åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            showResult('ğŸš€ ç®¡ç†å‘˜å¯†ç ä¿®æ”¹æµ‹è¯•é¡µé¢å·²åŠ è½½', 'success');
            showResult('ğŸ’¡ ç‚¹å‡»ç›¸åº”æŒ‰é’®å¼€å§‹æµ‹è¯•å„é¡¹åŠŸèƒ½', 'info');
        });
    </script>
</body>
</html>
