<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è‡ªåŠ¨åŒ¹é…åŠŸèƒ½ç®€å•æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 20px auto;
            padding: 20px;
        }
        .card {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            background: white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        button {
            background: #1890ff;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            width: 100%;
        }
        button:hover {
            background: #40a9ff;
        }
        .switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 26px;
        }
        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 26px;
        }
        .slider:before {
            position: absolute;
            content: "";
            height: 20px;
            width: 20px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        input:checked + .slider {
            background-color: #1890ff;
        }
        input:checked + .slider:before {
            transform: translateX(24px);
        }
        .auto-match-result {
            margin-top: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #e9ecef;
            display: none;
        }
        .debug-log {
            background: #000;
            color: #00ff00;
            padding: 15px;
            border-radius: 5px;
            font-family: monospace;
            height: 200px;
            overflow-y: auto;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <h1 style="text-align: center; color: #1890ff;">ğŸ¤– è‡ªåŠ¨åŒ¹é…åŠŸèƒ½æµ‹è¯•</h1>
    
    <div class="card">
        <h2>ğŸ“‹ ç™»è®°ç»„é˜Ÿ</h2>
        <div class="form-group">
            <label for="nameInput">å°çº¢ä¹¦å·ï¼š<span style="color: red;">*</span></label>
            <input type="text" id="nameInput" placeholder="ä¾‹å¦‚ï¼š2789378855" value="2789378855">
        </div>
        <div class="form-group">
            <label for="scoreInput">èŠéº»åˆ† (350-950)<span style="color: red;">*</span></label>
            <input type="number" id="scoreInput" min="350" max="950" placeholder="ä¾‹å¦‚ï¼š829" value="829">
        </div>
        <button onclick="addParticipant()">
            âœš ç™»è®°ç»„é˜Ÿ
        </button>
        
        <!-- è‡ªåŠ¨åŒ¹é…å¼€å…³ -->
        <div class="form-group" style="margin-top: 15px; padding: 12px; background: #f0f8ff; border-radius: 8px; border: 1px solid #d1e7ff;">
            <div style="display: flex; align-items: center; justify-content: space-between;">
                <div>
                    <label style="font-weight: 600; color: #1a365d; margin-bottom: 5px; display: block;">
                        ğŸ¤– è‡ªåŠ¨åŒ¹é…é˜Ÿå‹
                    </label>
                    <small style="color: #4a5568; font-size: 0.85rem;">
                        ç™»è®°åè‡ªåŠ¨æ˜¾ç¤ºåŒ…å«è¯¥ç”¨æˆ·çš„æ‰€æœ‰é˜Ÿä¼
                    </small>
                </div>
                <label class="switch">
                    <input type="checkbox" id="autoMatchToggle" onchange="toggleAutoMatch(this.checked)">
                    <span class="slider"></span>
                </label>
            </div>
        </div>
    </div>
    
    <!-- è‡ªåŠ¨åŒ¹é…ç»“æœæ˜¾ç¤ºåŒºåŸŸ -->
    <div id="autoMatchResult" class="auto-match-result">
        <h3 style="margin: 0; color: #1890ff;">ğŸ¤– è‡ªåŠ¨åŒ¹é…ç»“æœ</h3>
        <div id="autoMatchContent" style="margin-top: 15px;">
            <!-- è‡ªåŠ¨åŒ¹é…ç»“æœå°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
        </div>
    </div>
    
    <!-- è°ƒè¯•æ—¥å¿— -->
    <div class="card">
        <h3>ğŸ“‹ è°ƒè¯•æ—¥å¿—</h3>
        <div id="debugLog" class="debug-log">
[ç³»ç»Ÿ] æµ‹è¯•é¡µé¢å·²åŠ è½½
        </div>
        <button onclick="clearDebugLog()" style="margin-top: 10px; background: #fa8c16;">æ¸…ç©ºæ—¥å¿—</button>
    </div>

    <script>
        // å…¨å±€å˜é‡
        let isAutoMatchEnabled = false;
        let participants = [];
        let allCombinations = [];
        let lastAddedParticipant = null;
        
        // è°ƒè¯•æ—¥å¿—å‡½æ•°
        function logDebug(message) {
            const logElement = document.getElementById('debugLog');
            const timestamp = new Date().toLocaleTimeString();
            logElement.innerHTML += `[${timestamp}] ${message}\n`;
            logElement.scrollTop = logElement.scrollHeight;
            console.log(`[${timestamp}] ${message}`);
        }
        
        function clearDebugLog() {
            document.getElementById('debugLog').innerHTML = '[ç³»ç»Ÿ] æ—¥å¿—å·²æ¸…ç©º\n';
        }
        
        // è‡ªåŠ¨åŒ¹é…åŠŸèƒ½
        function toggleAutoMatch(enabled) {
            logDebug(`ğŸ”§ toggleAutoMatch called with: ${enabled}`);
            isAutoMatchEnabled = enabled;
            
            const resultArea = document.getElementById('autoMatchResult');
            logDebug(`ğŸ” resultArea element: ${resultArea ? 'found' : 'not found'}`);
            
            if (enabled) {
                if (resultArea) {
                    resultArea.style.display = 'block';
                    logDebug('âœ… Auto match result area displayed');
                }
                // å¦‚æœå·²ç»æœ‰å‚ä¸è€…ä¸”æœ€è¿‘æ·»åŠ äº†ç”¨æˆ·ï¼Œç«‹å³æ˜¾ç¤ºç»“æœ
                if (lastAddedParticipant && participants.length > 0) {
                    logDebug(`ğŸ”„ Triggering immediate auto match for: ${lastAddedParticipant.name}`);
                    performAutoMatch(lastAddedParticipant.name);
                }
            } else {
                if (resultArea) {
                    resultArea.style.display = 'none';
                    logDebug('âŒ Auto match result area hidden');
                }
            }
        }
        
        async function performAutoMatch(xiaohongshuId) {
            logDebug(`ğŸš€ performAutoMatch called with xiaohongshuId: ${xiaohongshuId}`);
            const resultContent = document.getElementById('autoMatchContent');
            logDebug(`ğŸ” resultContent element: ${resultContent ? 'found' : 'not found'}`);
            
            if (!xiaohongshuId) {
                logDebug('âŒ No xiaohongshuId provided');
                if (resultContent) {
                    resultContent.innerHTML = `
                        <div style="text-align: center; padding: 30px; color: #8c8c8c;">
                            <div style="font-size: 2rem; margin-bottom: 10px;">ğŸ¤”</div>
                            <p>è¯·è¾“å…¥å°çº¢ä¹¦å·å¼€å§‹è‡ªåŠ¨åŒ¹é…</p>
                        </div>
                    `;
                }
                return;
            }
            
            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            if (resultContent) {
                resultContent.innerHTML = `
                    <div style="text-align: center; padding: 20px; color: #1890ff;">
                        <div style="font-size: 2rem; margin-bottom: 10px;">ğŸ”„</div>
                        <p>æ­£åœ¨ä¸º ${xiaohongshuId} å¯»æ‰¾åŒ¹é…çš„é˜Ÿå‹...</p>
                    </div>
                `;
                logDebug('ğŸ”„ Loading state displayed');
            }
            
            try {
                // æ¨¡æ‹ŸåŒ¹é…è¿‡ç¨‹
                logDebug(`ğŸ“Š Current state - participants: ${participants.length}`);
                if (participants.length < 2) {
                    logDebug('âš ï¸ Not enough participants for matching');
                    if (resultContent) {
                        resultContent.innerHTML = `
                            <div style="text-align: center; padding: 30px; color: #8c8c8c;">
                                <div style="font-size: 2rem; margin-bottom: 10px;">ğŸ‘¥</div>
                                <p>è‡³å°‘éœ€è¦2ä¸ªå‚ä¸è€…æ‰èƒ½è¿›è¡ŒåŒ¹é…</p>
                                <p style="font-size: 0.9rem; margin-top: 10px;">
                                    å½“å‰åªæœ‰ ${participants.length} ä¸ªå‚ä¸è€…
                                </p>
                            </div>
                        `;
                    }
                    return;
                }
                
                // æ¨¡æ‹ŸåŒ¹é…å»¶è¿Ÿ
                logDebug('ğŸ”„ Simulating match calculation...');
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                // ç”Ÿæˆæ¨¡æ‹Ÿç»“æœ
                const mockCombinations = [
                    {
                        members: [
                            { id: 'P001', name: xiaohongshuId, score: 829 },
                            { id: 'P002', name: '1234567890', score: 675 },
                            { id: 'P003', name: '0987654321', score: 522 }
                        ]
                    },
                    {
                        members: [
                            { id: 'P001', name: xiaohongshuId, score: 829 },
                            { id: 'P004', name: '1111111111', score: 950 },
                            { id: 'P005', name: '2222222222', score: 247 }
                        ]
                    }
                ];
                
                logDebug(`ğŸ¯ Generated ${mockCombinations.length} mock combinations`);
                
                // æ˜¾ç¤ºç»“æœ
                renderAutoMatchResult(mockCombinations, xiaohongshuId);
                
            } catch (error) {
                logDebug(`âŒ Auto match failed: ${error.message}`);
                if (resultContent) {
                    resultContent.innerHTML = `
                        <div style="text-align: center; padding: 30px; color: #ff4d4f;">
                            <div style="font-size: 2rem; margin-bottom: 10px;">âŒ</div>
                            <p>è‡ªåŠ¨åŒ¹é…å¤±è´¥</p>
                            <p style="font-size: 0.9rem; margin-top: 10px;">${error.message}</p>
                        </div>
                    `;
                }
            }
        }
        
        function renderAutoMatchResult(combos, xiaohongshuId) {
            const resultContent = document.getElementById('autoMatchContent');
            logDebug(`ğŸ¨ Rendering ${combos.length} combinations for ${xiaohongshuId}`);
            
            if (combos.length === 0) {
                resultContent.innerHTML = `
                    <div style="text-align: center; padding: 30px; color: #8c8c8c;">
                        <div style="font-size: 2rem; margin-bottom: 10px;">ğŸ”</div>
                        <p>æœªæ‰¾åˆ°åŒ…å« ${xiaohongshuId} çš„ç»„åˆ</p>
                    </div>
                `;
                return;
            }
            
            let html = `
                <div style="text-align: center; margin-bottom: 20px; padding: 15px; background: linear-gradient(135deg, #e6f7ff 0%, #f6ffed 100%); border-radius: 8px;">
                    <div style="font-size: 1.5rem; color: #1890ff; font-weight: bold; margin-bottom: 8px;">
                        ğŸ¯ æ‰¾åˆ° ${combos.length} ä¸ªåŒ…å« ${xiaohongshuId} çš„ç»„åˆ
                    </div>
                    <div style="color: #595959; font-size: 0.95rem;">
                        ç³»ç»Ÿå·²è‡ªåŠ¨ä¸ºæ‚¨åŒ¹é…åˆ°åˆé€‚çš„é˜Ÿå‹
                    </div>
                </div>
            `;
            
            combos.forEach((combo, index) => {
                const membersHtml = combo.members.map(member => {
                    const isTarget = member.name === xiaohongshuId;
                    return `
                        <div style="
                            display: flex;
                            justify-content: space-between;
                            align-items: center;
                            padding: 10px;
                            border: ${isTarget ? '2px solid #1890ff' : '1px solid #d9d9d9'};
                            border-radius: 6px;
                            margin-bottom: 8px;
                            background: ${isTarget ? '#e6f7ff' : 'white'};
                        ">
                            <div>
                                <div style="font-weight: bold; color: #1890ff;">${member.id}</div>
                                <div style="${isTarget ? 'color: #1890ff; font-weight: bold;' : ''}">
                                    ${member.name}
                                </div>
                            </div>
                            <div style="font-size: 1.2rem; font-weight: bold; color: #1677ff;">
                                ${member.score}åˆ†
                            </div>
                        </div>
                    `;
                }).join('');
                
                html += `
                    <div style="margin-bottom: 20px; border: 1px solid #e8e8e8; border-radius: 8px; overflow: hidden;">
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px 15px; background: #fafafa; border-bottom: 1px solid #e8e8e8;">
                            <div style="font-weight: bold; color: #1890ff;">ç»„åˆ #${index + 1}</div>
                            <div style="font-weight: bold; color: #52c41a;">2026 åˆ†</div>
                        </div>
                        <div style="padding: 15px;">
                            ${membersHtml}
                        </div>
                    </div>
                `;
            });
            
            resultContent.innerHTML = html;
            logDebug('âœ… Results rendered successfully');
        }
        
        // æ·»åŠ å‚ä¸è€…åŠŸèƒ½
        function addParticipant() {
            const nameInput = document.getElementById('nameInput');
            const scoreInput = document.getElementById('scoreInput');
            
            const name = nameInput.value.trim();
            const score = parseInt(scoreInput.value);
            
            if (!name || isNaN(score)) {
                logDebug('âŒ Invalid input data');
                alert('è¯·è¾“å…¥å®Œæ•´ä¿¡æ¯');
                return;
            }
            
            const participantId = 'P' + String(Date.now()).slice(-6);
            const participant = { id: participantId, name, score };
            
            participants.push(participant);
            lastAddedParticipant = participant;
            
            logDebug(`ğŸ“ Participant added: ${name} (${score}åˆ†, ID: ${participantId})`);
            logDebug(`ğŸ¤– Auto match enabled: ${isAutoMatchEnabled}`);
            
            // æ¸…ç©ºè¾“å…¥æ¡†
            nameInput.value = '';
            scoreInput.value = '';
            
            // å¦‚æœå¯ç”¨äº†è‡ªåŠ¨åŒ¹é…ï¼Œæ‰§è¡Œè‡ªåŠ¨åŒ¹é…
            if (isAutoMatchEnabled) {
                logDebug(`ğŸš€ Scheduling auto match for: ${name}`);
                setTimeout(() => {
                    logDebug(`â° Executing delayed auto match for: ${name}`);
                    performAutoMatch(name);
                }, 500);
            } else {
                logDebug('â­ï¸ Auto match not enabled, skipping');
            }
        }
        
        // é¡µé¢åŠ è½½å®Œæˆ
        document.addEventListener('DOMContentLoaded', () => {
            logDebug('ğŸš€ Simple test page loaded successfully');
            logDebug('ğŸ’¡ æµ‹è¯•æ­¥éª¤ï¼š');
            logDebug('   1. å¼€å¯"è‡ªåŠ¨åŒ¹é…é˜Ÿå‹"å¼€å…³');
            logDebug('   2. ç‚¹å‡»"ç™»è®°ç»„é˜Ÿ"æŒ‰é’®');
            logDebug('   3. è§‚å¯Ÿè‡ªåŠ¨åŒ¹é…ç»“æœæ˜¾ç¤º');
        });
    </script>
</body>
</html>